---
import Layout from "../../layouts/Layout.astro";
import PlotFigure from "../../components/PlotFigure.astro";
import penguins from "../../assets/penguins.json";
import * as Plot from "@observablehq/plot";

// IMPORTANT : G√©n√©rer les pages statiquement avec getStaticPaths
export async function getStaticPaths() {
  // G√©n√©rer automatiquement la liste des esp√®ces
  const species = [...new Set(penguins.map((p) => p.species))].filter((s) => s);

  // Retourner un tableau de param√®tres pour chaque esp√®ce
  return species.map((speciesName) => ({
    params: {
      species: speciesName,
    },
    props: {
      // Passer les donn√©es filtr√©es en props
      filteredPenguins: penguins.filter((p) => p.species === speciesName),
    },
  }));
}

// R√©cup√©rer les props et params
const { species } = Astro.params;
const { filteredPenguins } = Astro.props;

// Configuration du graphique
const plotOptions = {
  title: `Analyse de l'esp√®ce ${species} (Statique)`,
  grid: true,
  marks: [
    Plot.dot(filteredPenguins, {
      x: "culmen_length_mm",
      y: "culmen_depth_mm",
      fill: "sex",
      stroke: "white",
      r: 5,
      fillOpacity: 0.8,
    }),
  ],
  x: {
    label: "Longueur du bec (mm)",
  },
  y: {
    label: "Profondeur du bec (mm)",
  },
  color: { legend: true },
};
---

<Layout>
  <div class="container mx-auto px-4">
    <!-- Breadcrumb -->
    <div class="breadcrumbs text-sm mb-6">
      <ul>
        <li><a href="/" class="link link-hover">üè† Accueil</a></li>
        <li><a href="/rendu-statique" class="link link-hover">Routes Statiques</a></li>
        <li>{species}</li>
      </ul>
    </div>

    <!-- Hero -->
    <div class="hero bg-gradient-to-r from-green-400 to-emerald-600 text-white rounded-lg mb-8">
      <div class="hero-content">
        <div class="text-center">
          <h1 class="text-4xl font-bold">üêß {species}</h1>
          <p class="py-4">{filteredPenguins.length} individus analys√©s</p>
          <div class="badge badge-success">‚ö° Route Statique</div>
        </div>
      </div>
    </div>

    <!-- Stats -->
    <div class="stats stats-vertical lg:stats-horizontal shadow mb-8 w-full">
      <div class="stat">
        <div class="stat-figure text-primary">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-8 h-8 stroke-current">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg>
        </div>
        <div class="stat-title">M√¢les</div>
        <div class="stat-value text-primary">{filteredPenguins.filter((p) => p.sex === "MALE").length}</div>
      </div>
      
      <div class="stat">
        <div class="stat-figure text-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-8 h-8 stroke-current">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
          </svg>
        </div>
        <div class="stat-title">Femelles</div>
        <div class="stat-value text-secondary">{filteredPenguins.filter((p) => p.sex === "FEMALE").length}</div>
      </div>

      <div class="stat">
        <div class="stat-figure text-accent">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-8 h-8 stroke-current">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
          </svg>
        </div>
        <div class="stat-title">Total</div>
        <div class="stat-value text-accent">{filteredPenguins.length}</div>
      </div>
    </div>

    <!-- Chart Card -->
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title text-2xl mb-4">üìä Analyse Graphique</h2>
        <PlotFigure options={plotOptions} />
      </div>
    </div>
  </div>
</Layout>
